<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
             "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="net.skhu.mapper.UserMapper">

	<select id="findOneByUser_id" resultType="User">
		SELECT * FROM user WHERE user_id = #{user_id}
	</select>
	
	<select id="findOneById" resultType="User">
		SELECT * FROM user
		WHERE id = #{id}
	</select>
	
	<select id="findAll" resultType="User">
		SELECT * FROM user
	</select>
	
	<select id="findAllManager" resultType="User">
		SELECT u.*, d.d_name
		FROM user u left join department d ON u.major_id=d.id
		WHERE type=2;
	</select>
	
	<select id="findAllReport" resultType="Report">
		SELECT r.*, m.group_name
		FROM report r left join mentor_apply m ON r.rep_u_id=m.mentor_u_id
	</select>
	
	<select id="findAllWithReports" resultMap="resultMap1">     
	  SELECT m.*, r.id report_id, r.subject rep_subject, r.place, r.create_date     
	  FROM mentor_apply m LEFT JOIN report r ON m.mentor_u_id = r.rep_u_id   
	</select> 
	  
	<resultMap id="resultMap1" type="Mentor">    
		<id property="id" column="id" />    
		<result property="group_name" column="group_name" />     
		<collection property="reports" ofType="Report">       
			<id property="id" column="report_id" />      
			<result property="subject" column="rep_subject"/>      
			<result property="place" column="place"/>       
			<result property="create_date" column="create_date"/>     
		</collection>   
	</resultMap> 
	
	<select id="findAllMentor" resultType="User">
		SELECT u.*, d.d_name
		FROM user u left join department d ON u.major_id=d.id
		WHERE type=3;
	</select>
	
	<select id="findAllMentee" resultType="User">
		SELECT u.*, d.d_name
		FROM user u left join department d ON u.major_id=d.id
		WHERE type=4;
	</select>
	
	<select id="findByName" resultType="User">
		SELECT u.*, d.d_name
		FROM user u left join department d ON u.major_id=d.id
		WHERE name like '%'||#{name}||'%';
	</select>

	<update id="update">
		UPDATE user SET pw = #{pw}, email = #{email}, phone = #{phone} WHERE id = #{id}
	</update>
	
	<insert id="insertWithMinor" useGeneratedKeys="true" keyProperty="id">
	    INSERT user (user_id, pw, name, email, phone, office, office_tel, type, major_id, status_id, auth_date, minor_id)
	    VALUES (#{user_id}, #{pw}, #{name}, #{email}, #{phone}, #{office}, #{office_tel}, #{type}, #{major_id}, #{status_id}, now(), #{minor_id})
	</insert>
	
	<insert id="insertWithDouble" useGeneratedKeys="true" keyProperty="id">
	    INSERT user (user_id, pw, name, email, phone, office, office_tel, type, major_id, status_id, auth_date, double_id)
	    VALUES (#{user_id}, #{pw}, #{name}, #{email}, #{phone}, #{office}, #{office_tel}, #{type}, #{major_id}, #{status_id}, now(), #{double_id})
	</insert>
	
	<insert id="insertWithDep" useGeneratedKeys="true" keyProperty="id">
	    INSERT user (user_id, pw, name, email, phone, office, office_tel, type, major_id, status_id, auth_date)
	    VALUES (#{user_id}, #{pw}, #{name}, #{email}, #{phone}, #{office}, #{office_tel}, #{type}, #{major_id}, #{status_id}, now())
	</insert>
	
	<delete id="delete">
	    DELETE FROM user WHERE id = #{id}
	</delete>
	
	<insert id="m_setting" useGeneratedKeys="true" keyProperty="id">
	    INSERT into setting (mentor_start_date, mentor_expire_date, mentee_start_date, mentee_expire_date, study_count, max_mentor, max_mentee, min_mentee, report_deadline)
	    VALUES (#{mentor_start_date}, #{mentor_expire_date}, #{mentee_start_date}, #{mentee_expire_date}, #{study_count}, #{max_mentor}, #{max_mentee}, #{min_mentee}, #{report_deadline})
	</insert>

</mapper>

